# task_context 格式示例

> 本文档提供通用的 task_context 格式模板
> 适用于所有项目和场景

---

## 最小化模板（小型项目）

```markdown
【项目根目录】/home/user/project/

【SPEC 文件引用】
- /home/user/project/SPEC/01-REQUIREMENTS.md
  说明：功能需求定义
  关键：所有 REQ-XXX 条目

【核心约束】
- 实现方式：[具体说明]
- 技术栈：[必须使用/禁止使用]
- 验收标准：[具体标准]

【功能清单】
- [功能描述 1]
- [功能描述 2]
```

---

## 标准模板（中大型项目）

```markdown
【项目根目录】/home/user/project/

【SPEC 文件引用】（⚠️ 强制：完整路径 + 说明）

1. /home/user/project/SPEC/01-REQUIREMENTS.md
   说明：功能需求定义（REQ-XXX）
   关键章节：所有需求条目

2. /home/user/project/SPEC/02-ARCHITECTURE.md
   说明：架构设计（ARCH-XXX）
   关键章节：
   - LXX: [章节名称] → [关键决策说明]

3. /home/user/project/SPEC/XX-XXX.md
   说明：[文件作用]
   关键章节：[具体章节]

【核心约束】⚠️ 违反即失败

1. 实现方式约束
   ✅ 允许：[具体行为]
   ❌ 禁止：[具体行为]

2. 技术栈约束
   ✅ 必须使用：[技术/库]
   ❌ 禁止使用：[技术/库]

3. 架构原则
   - [原则 1]
   - [原则 2]

【背景文档】
- /home/user/project/SPEC/DOCS/AI-DEVELOPER-GUIDE.md
  说明：详细开发指南

【功能清单】（必须一次性完成）
- [功能/需求 ID 1]：[描述]
- [功能/需求 ID 2]：[描述]
- [功能/需求 ID 3]：[描述]

【代码复用】
- 可复用：[模块位置和用法]
- 参考：[外部实现位置]

【验收标准】
- [ ] [标准 1]
- [ ] [标准 2]
- [ ] [标准 3]
```

---

## 格式要素说明

### 必需要素

| 要素 | 格式 | 说明 | 示例 |
|------|------|------|------|
| **项目根目录** | 绝对路径 | AI-CLI 工作目录 | `/home/user/project/` |
| **SPEC 文件引用** | 完整路径 + 说明 | 告诉 AI-CLI 读什么 | 见下方 |
| **核心约束** | 允许/禁止列表 | 明确边界 | 见下方 |
| **功能清单** | ID + 描述 | 要实现的功能 | `REQ-001: 功能描述` |
| **验收标准** | 检查清单 | 完成标准 | `[ ] 验证通过` |

### SPEC 文件引用格式

```markdown
【SPEC 文件引用】（⚠️ 强制）
- /完整路径/SPEC/XX-XXX.md
  说明：[文件作用]
  关键章节：
  - LXX: [章节名称] → [关键内容说明]
```

**关键**：
- 必须使用**绝对路径**
- 每个文件要有**说明**（作用）
- 标注**关键章节**（行号或名称）
- 引用**关键原文**（用 → 引导）

### 核心约束格式

```markdown
【核心约束】⚠️ 违反即失败

1. [约束类别]
   ✅ 允许：[具体行为]
   ❌ 禁止：[具体行为]
```

**关键**：
- 用 **⚠️** 标记重要性
- 用 **✅** 标记允许行为
- 用 **❌** 标记禁止行为
- **禁止**比**允许**更重要

### 功能清单格式

```markdown
【功能清单】（必须一次性完成）
- [ID]：[描述]
- [ID]：[描述]
```

**关键**：
- **必须一次性完成**（不允许分批）
- 使用 **需求 ID** 或 **功能描述**
- 明确 **批量执行** 的所有项

---

## 常见错误

### 错误 1：使用相对路径

```markdown
❌ 错误：
【SPEC 文件引用】
- SPEC/01-REQUIREMENTS.md

✅ 正确：
【SPEC 文件引用】
- /home/user/project/SPEC/01-REQUIREMENTS.md
```

### 错误 2：没有文件说明

```markdown
❌ 错误：
【SPEC 文件引用】
- /path/to/SPEC/01-REQUIREMENTS.md
- /path/to/SPEC/02-ARCHITECTURE.md

✅ 正确：
【SPEC 文件引用】
- /path/to/SPEC/01-REQUIREMENTS.md
  说明：功能需求定义
  关键章节：所有需求条目
- /path/to/SPEC/02-ARCHITECTURE.md
  说明：架构设计
  关键章节：模块划分、技术栈
```

### 错误 3：约束不明确

```markdown
❌ 错误：
【核心约束】
- 纯 Rust 实现
- 高性能

✅ 正确：
【核心约束】⚠️ 违反即失败
1. 实现方式约束
   ✅ src/ 中所有代码必须是纯 Rust
   ❌ 禁止在 src/ 中使用 FFI 调用
   ❌ 禁止使用 XXX 库
```

### 错误 4：没有禁止行为

```markdown
❌ 错误：
【核心约束】
- 实现算法 A
- 实现算法 B

✅ 正确：
【核心约束】
- 算法 A：用纯 Rust 实现
  ❌ 禁止调用外部 C 函数
  ❌ 禁止使用 XXX 库
- 算法 B：参考 XXX 实现
  ❌ 禁止直接复制代码
```

---

## 使用步骤

### 步骤 1：确定项目根目录

```bash
pwd
# 输出：/home/user/project
```

### 步骤 2：列出所有 SPEC 文件

```bash
find SPEC -name "*.md" -type f
```

### 步骤 3：提取关键约束

从 SPEC 文件中找到：
- 技术栈约束
- 实现方式约束
- 架构原则
- 禁止行为

### 步骤 4：标注关键章节

找到约束定义的位置：
- 行号（如 L11）
- 章节名称（如 §ARCH-XXX）
- 关键原文（用 → 引导）

### 步骤 5：验证完整性

检查清单：
- [ ] 项目根目录是绝对路径
- [ ] 所有 SPEC 有完整路径
- [ ] 每个 SPEC 有说明
- [ ] 有关键章节引用
- [ ] 核心约束明确
- [ ] 禁止行为明确
- [ ] 背景文档存在或已创建

---

## 验证检查清单

**调用 AI-CLI 前必须验证**：

### SPEC 文件
- [ ] 使用绝对路径
- [ ] 每个 SPEC 有说明
- [ ] 有关键章节引用
- [ ] 引用了关键原文

### 核心约束
- [ ] 明确列出约束类别
- [ ] 有允许行为（✅）
- [ ] 有禁止行为（❌）
- [ ] 禁止行为比允许行为多

### 功能清单
- [ ] 所有功能一次性列出
- [ ] 有明确的 ID 或描述
- [ ] 说明了"必须一次性完成"

### 验收标准
- [ ] 标准具体可验证
- [ ] 使用检查清单格式
- [ ] 有验证命令或方法

---

## 后果

**不遵循格式的后果**：
- ❌ AI-CLI 找不到 SPEC 文件
- ❌ AI-CLI 不知道关键约束
- ❌ AI-CLI 错误理解需求
- ❌ 产生大量错误代码
- ❌ 需要完全重写

**遵循格式的效果**：
- ✅ AI-CLI 能读取所有 SPEC
- ✅ AI-CLI 理解核心约束
- ✅ AI-CLI 正确实现需求
- ✅ 减少返工和修改

---

**文档版本**：v1.1.0
**更新日期**：2025-12-23
**维护者**：programmer 技能维护
